<!doctype html>
<html lang="en">
   <head>
		<title>Example with Google maps, jQuery and JSON - Google maps jQuery plugin</title>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta http-equiv="content-language" content="en" />
		<meta name="author" content="Johan Säll Larsson" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<meta name="keywords" content="Google maps, jQuery, plugin, JSON" />
		<meta name="description" content="An example how to load markers with JSON using jQuery and Google maps v3" />
		<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
		<meta name="DC.title" content="Example with Google maps, jQuery and JSON - Google maps jQuery plugin" />
		<meta name="DC.subject" content="Google maps;jQuery;plugin;JSON" />
		<meta name="DC.description" content="An example how to load markers with JSON using jQuery and Google maps v3" />
		<meta name="DC.creator" content="Johan Säll Larsson" />
		<meta name="DC.language" content="en" />
		<link type="text/css" rel="stylesheet" href="css/960/min/960.css" />
		<link type="text/css" rel="stylesheet" href="css/960/min/960_16_col.css" />
		<link type="text/css" rel="stylesheet" href="css/normalize/min/normalize.css" />
		<link type="text/css" rel="stylesheet" href="css/prettify/min/prettify.css" />
		<link type="text/css" rel="stylesheet" href="css/style.css" />
		<script type="text/javascript" src="js/modernizr-2.0.6/modernizr.min.js"></script>
    </head>
    <body>
		<header class="dark">
			<div class="container_16">
				<h1><a href="/">Google maps jQuery plugin <span id="version"></span></a> show markers from JSON example</h1>
			</div>
		</header>
		<div class="container_16">
			<article class="grid_16">
				<div class="item rounded dark" id="map-parent">
					<div id="map_canvas" class="map rounded"></div>
					<!--<div id="map_canvas1" class="map rounded"></div>-->
				</div>
				<div class="content rounded light shadow">
					<h2>Using jquery with Google maps</h2>
					<p>Download <a href="http://jquery.com/">jQuery 1.4.X or higher</a> or use <a href="http://code.google.com/intl/sv-SE/apis/libraries/devguide.html">Googles</a> or <a href="http://www.asp.net/ajaxlibrary/cdn.ashx">Microsofts</a>  <abbr title="Content delivery network"><a href="http://en.wikipedia.org/wiki/Content_delivery_network">CDN</a></abbr>.</p>
<pre class="prettyprint rounded">
&lt;script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="PATH_TO_PLUGIN/jquery.ui.map.js"&gt;&lt;/script&gt;</pre>

<pre class="prettyprint rounded">
$('#map_canvas').gmap().bind('init', function() { 
	// This URL won't work on your localhost, so you need to change it
	// see http://en.wikipedia.org/wiki/Same_origin_policy
	$.getJSON( 'http://jquery-ui-map.googlecode.com/svn/trunk/demos/json/demo.json', function(data) { 
		$.each( data.markers, function(i, marker) {
			$('#map_canvas').gmap('addMarker', { 
				'position': new google.maps.LatLng(marker.latitude, marker.longitude), 
				'bounds': true 
			}).click(function() {
				$('#map_canvas').gmap('openInfoWindow', { 'content': marker.content }, this);
			});
		});
	});
});</pre>
					<p>There are many ways of writing this snippet, please refer to the <a href="http://code.google.com/p/jquery-ui-map/wiki/jquery_ui_map_v_3_sample_code">sample code</a> section in the wiki.</p>
				</div>
			</article>
		</div>
		<footer class="dark">
			<div class="container_16">
				<div class="grid_8">
					<h2>More Google maps and jQuery examples</h2>
					<ul>
						<li><a href="jquery-google-maps-basic-example.html">Google maps and jQuery basics</a></li>
						<li><a href="jquery-google-maps-geolocation.html">Google maps with geolocation</a></li>
						<li><a href="jquery-google-maps-clustering.html">Using clusters with MarkerClusteredPlus</a></li>
						<li><a href="jquery-google-maps-streetview.html">Microformats, Google streetview and jQuery dialog</a></li>
						<li><a href="jquery-google-maps-geocoding.html">Click and drag events with Google geo search</a></li>
						<li class="sel buttonize"><a href="jquery-google-maps-json.html">Show markers from JSON</a></li>
						<li><a href="jquery-google-maps-microdata.html">Show markers with microdata</a></li>
						<li><a href="jquery-google-maps-microformat.html">Show markers with microformats</a></li>
						<li><a href="jquery-google-maps-rdfa.html">Show markers with RDFa</a></li>
						<li><a href="jquery-google-maps-fusion-tables.html">Show markers from Google Fusion tables</a></li>
						<li><a href="jquery-google-maps-filtering.html">Filter markers by property</a></li>
						<li><a href="jquery-google-maps-mobile.html">Google maps with <strong>jQuery mobile</strong></a></li>
					</ul>
				</div>
				<div id="forum" class="hidden rounded forum grid_8"></div>
				<div class="grid_16" itemscope itemtype="http://data-vocabulary.org/Person">
					Author: <span itemprop="name">Johan S&auml;ll Larsson</span> (<a href="http://johansalllarsson.se" itemprop="url">http://johansalllarsson.se</a>)
				</div>
			</div>
		</footer>
		
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script type="text/javascript" src="js/markerclustererplus-2.0.6/markerclusterer.min.js"></script>
		<script type="text/javascript" src="js/jquery-1.7.1/jquery.min.js"></script>
		<script type="text/javascript" src="js/underscore-1.2.2/underscore.min.js"></script>
		<script type="text/javascript" src="js/backbone-0.5.3/backbone.min.js"></script>
		<script type="text/javascript" src="js/prettify/prettify.min.js"></script>
		<script type="text/javascript" src="js/demo.js"></script>
		<script type="text/javascript" src="../ui/jquery.ui.map.js"></script>
		<script type="text/javascript">
            $(function() {

            	var getMapKPPN = function(kdkanwil,lat,lng){

            		//$('#map_canvas').gmap('refresh');
            		//$('#map_canvas').gmap('clear', 'markers');
            		//$('#map_canvas').gmap('destroy');

            		$('#map-parent').html(
            			'<div id="map_canvas" class="map rounded"></div>'
            		);

            		$.getJSON('test1.php?kdkanwil='+kdkanwil,function(result){
            			var arr_lat_kppn = new Array();
						var arr_lng_kppn = new Array();
						var arr_kdkppn = new Array();
						var arr_urkppn = new Array();

						$.each(result,function(index,field){
							arr_lat_kppn.push(field.lat);
							arr_lng_kppn.push(field.lng);
							arr_kdkppn.push(field.kdkppn);
							arr_urkppn.push(field.urkppn);
						});

						var center=lat+","+lng;

						$('#map_canvas').gmap({
								'zoom': 5,
								//'maxZoom': 15,
								//'minZoom':5,
								'center':'-3.776559,116.271972',
								'disableDefaultUI':false,
								'mapTypeControl': true,
								'mapTypeControlOptions': {
									'style': google.maps.MapTypeControlStyle.DROPDOWN_MENU
								},
								'mapTypeId': google.maps.MapTypeId.HYBRID
							}).bind('init', function(evt, map) {

								var map_kppn = function(lat_kppn,lng_kppn,kdkppn,urkppn){ 
									$('#map_canvas').gmap('addMarker', {
										'position': new google.maps.LatLng(lat_kppn, lng_kppn),
										'icon'    : {
											'url'		:'images/stasiun.png',
											'size'		: new google.maps.Size(80, 80),
											'origin'	: new google.maps.Point(0, 0),
											'anchor'	: new google.maps.Point(17, 34),
											'scaledSize': new google.maps.Size(40, 40)
										}
									}).click(function() {
										alert('OK');
									});
								};

								for ( var i = 0; i < arr_lat_kppn.length; i++ ) {
									var lat_kppn = arr_lat_kppn[i];
									var lng_kppn = arr_lng_kppn[i];
									var kdkppn = arr_kdkppn[i];
									var urkppn = arr_urkppn[i];
									map_kppn(lat_kppn,lng_kppn,kdkppn,urkppn);
								}

								$('#map_canvas').gmap('set', 'MarkerClusterer', new MarkerClusterer(map, $(this).gmap('get', 'markers')));

						});

            		});

            	};
				
            	var getMap = function(){

            		$.getJSON('test.php',function(result){

            			var arr_lat = new Array();
						var arr_lng = new Array();
						var arr_kdkanwil = new Array();
						var arr_nmkanwil = new Array();

            			$.each(result,function(index,field){
							arr_lat.push(field.lat);
							arr_lng.push(field.lng);
							arr_kdkanwil.push(field.kdkanwil);
							arr_nmkanwil.push(field.nmkanwil);
						});

            			$('#map_canvas').gmap({
							'zoom': 5,
							//'maxZoom': 15,
							//'minZoom':5,
							'center':'-3.776559,116.271972',
							'disableDefaultUI':false,
							'mapTypeControl': true,
							'mapTypeControlOptions': {
								'style': google.maps.MapTypeControlStyle.DROPDOWN_MENU
							},
							'mapTypeId': google.maps.MapTypeId.HYBRID
						}).bind('init', function(evt, map) {
							
							var map_ = function(lat,lng,kdkanwil,nmkanwil){ $('#map_canvas').gmap('addMarker', {
									'position': new google.maps.LatLng(lat, lng),
									'icon'    : {
										'url'		:'images/home.png',
										'size'		: new google.maps.Size(80, 80),
										'origin'	: new google.maps.Point(0, 0),
										'anchor'	: new google.maps.Point(17, 34),
										'scaledSize': new google.maps.Size(40, 40)
									}
								}).click(function() {
									getMapKPPN(kdkanwil,lat,lng);
								});
							};
							
							for ( var i = 0; i < arr_lat.length; i++ ) {
								var lat = arr_lat[i];
								var lng = arr_lng[i];
								var kdkanwil = arr_kdkanwil[i];
								var nmkanwil = arr_nmkanwil[i];
								map_(lat,lng,kdkanwil,nmkanwil);
							}
							
							$('#map_canvas').gmap('set', 'MarkerClusterer', new MarkerClusterer(map, $(this).gmap('get', 'markers')));
							
							//geocoder = new google.maps.Geocoder();
					
							/*$('#cari_lokasi').click(function(){
								var address = document.getElementById('lokasi').value;
								geocoder.geocode( { 'address': address}, function(results, status) {
									if (status == google.maps.GeocoderStatus.OK) {
										map.setCenter(results[0].geometry.location);
										map.setZoom(12);
										//var marker = new google.maps.Marker({
											//map: map,
											//position: results[0].geometry.location
										//});
									}
									else {
										alert('Geocode was not successful for the following reason: ' + status);
									}
								});
							});*/
							
						});

            		});

            	};

            	getMap();

			});
        </script>
    
	</body>
</html>